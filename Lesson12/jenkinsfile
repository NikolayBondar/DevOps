pipeline {
    agent any
    stages {
        stage('Hello') {
            steps {
                echo 'Hello World'
            }
        }

        stage('Apache2') {
            steps {
                 

              sh '''#!/bin/bash

                id=$(systemctl status apache2 | grep PID | tr -s \' \' | cut -d \' \' -f4 | tr -d \'/n\')
                stat=$(systemctl status apache2| grep Active | tr -s " " | cut -d \' \' -f 3)

                name=$(systemctl status apache2 | grep \'apache2.service -\' | tr -s \' \' | cut -d \'-\' -f2)

                if [ -z $id ] || [ $stat == "inactive" ]
                then
                  echo "Process not found or Inactive"
                else

                `systemctl stop apache2`

                echo "Process $name $id stopped"

                sleep 10

                n=$(ps -p $id | wc -l)


                if [ "$n" -gt 1 ]	

                then

                `kill -15 $id`
                fi
                fi'''               
                           
            }
        }
    }
}
